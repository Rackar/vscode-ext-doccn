(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{305:function(s,t,e){"use strict";e.r(t);var a=e(17),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"测试你的插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试你的插件"}},[s._v("#")]),s._v(" 测试你的插件")]),s._v(" "),e("p",[s._v("VS Code可以运行和调试支持VS Code API的插件。这些测试会运行在VS Code的特殊实例"),e("code",[s._v("扩展开发环境")]),s._v("中，这个环境有权访问全部的API。我们将这样的测试称为集成测试，因为它远远超越了单独运行在VS Code中的单元测试。本篇侧重于VS Code的集成测试，至于单元测试，你可以使用任何流行的测试框架，如"),e("a",{attrs:{href:"https://mochajs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mocha"),e("OutboundLink")],1),s._v("或者"),e("a",{attrs:{href:"https://jasmine.github.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jasmine"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"yo-code测试脚手架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yo-code测试脚手架"}},[s._v("#")]),s._v(" Yo Code测试脚手架")]),s._v(" "),e("hr"),s._v(" "),e("p",[e("RouterLink",{attrs:{to:"/extension-authoring/extension-generator.html"}},[s._v("yo code 生成器")]),s._v("基础插件项目包含了一些示例测试和必要的基础设施。")],1),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("本篇假设你已经创建了一个Typescript插件（或Javascript插件），不然先参考"),e("a",{attrs:{href:"extension-authoring/extension-generator"}},[s._v("基础部分")])])]),s._v(" "),e("p",[s._v("打开一个插件项目目录，打开"),e("strong",[s._v("调试")]),s._v("侧边栏选择"),e("code",[s._v("Extension Tests")]),s._v("配置。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/Microsoft/vscode-docs/master/docs/extensions/images/testing-extensions/launch-tests.png",alt:"launch-tests"}})]),s._v(" "),e("p",[s._v("选中配置之后，点击绿色的小角标，启动调试。VS Code会在"),e("code",[s._v("扩展开发环境")]),s._v("实例中加载插件，然后运行调试。测试的输出会进入"),e("em",[s._v("调试控制台")]),s._v("：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/Microsoft/vscode-docs/master/docs/extensions/images/testing-extensions/test-output.png",alt:"test-output"}})]),s._v(" "),e("p",[s._v("生成的测试使用了"),e("a",{attrs:{href:"https://mochajs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mocha 测试框架"),e("OutboundLink")],1),s._v("的测试运行器和库。")]),s._v(" "),e("p",[s._v("插件项目文件夹中的附带了"),e("code",[s._v("src/test")]),s._v("，其中有一个"),e("code",[s._v("index.ts")]),s._v("文件，定义了Mocha测试运行器的配置，"),e("code",[s._v("extension.test.ts")]),s._v("中包含着测试示例"),e("code",[s._v("Something 1")]),s._v("。通常来说你可以不管"),e("code",[s._v("index.ts")]),s._v("，不过你也可以调整Mocha的配置。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("├── src\n│   └── test\n│       ├── extension.test.ts\n│       └── index.ts\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("你可以在"),e("code",[s._v("test")]),s._v("目录下创建更多的"),e("code",[s._v("test.ts")]),s._v("文件，它们会被自动构建（到"),e("code",[s._v("out/test")]),s._v("）然后运行。测试运行器只会匹配"),e("code",[s._v("*.test.ts")]),s._v("模式的文件。")]),s._v(" "),e("h2",{attrs:{id:"加载测试配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加载测试配置"}},[s._v("#")]),s._v(" 加载测试配置")]),s._v(" "),e("hr"),s._v(" "),e("p",[e("code",[s._v("Extension Tests")]),s._v("的配置文件在项目的"),e("code",[s._v(".vscode\\launch.json")]),s._v("的文件中。就像"),e("code",[s._v("Extension")]),s._v("配置一样，通过"),e("code",[s._v("--extensionTestsPath")]),s._v("参数，指定编译的测试文件位置（假设是Typescript项目）。")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Extension Tests"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"extensionHost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"launch"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runtimeExecutable"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${execPath}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"args"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--extensionDevelopmentPath=${workspaceFolder}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--extensionTestsPath=${workspaceFolder}/out/test"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"outFiles"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${workspaceFolder}/out/test/**/*.js"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h2",{attrs:{id:"将参数传递到扩展开发环境中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将参数传递到扩展开发环境中"}},[s._v("#")]),s._v(" 将参数传递到扩展开发环境中")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("在加载配置中添加参数列表，然后测试示例就能在你指定的目录或文件中启动测试了。")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"args"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file or folder name"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--extensionDevelopmentPath=${workspaceFolder}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--extensionTestsPath=${workspaceFolder}/out/test"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("用这个方式，你的测试就可以运行在可预测的文件结构中运行了。")]),s._v(" "),e("h2",{attrs:{id:"从项目中排除测试文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从项目中排除测试文件"}},[s._v("#")]),s._v(" 从项目中排除测试文件")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("当你想要分享插件的时候，你可能就不需要测试文件出现在"),e("em",[s._v("插件包")]),s._v("里了。"),e("a",{attrs:{href:"https://github.com/Microsoft/vscode-docs/blob/master/docs/extensions/publish-extension.md#advance-usage",target:"_blank",rel:"noopener noreferrer"}},[s._v(".vscodeignore"),e("OutboundLink")],1),s._v("文件可以让你在使用"),e("a",{attrs:{href:"https://github.com/Microsoft/vscode-docs/blob/master/docs/extensions/publish-extension.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("vsce构建工具"),e("OutboundLink")],1),s._v("的时候排除测试文件。默认情况下，"),e("code",[s._v("yo code")]),s._v("生成的项目会排除"),e("code",[s._v("test")]),s._v("和"),e("code",[s._v("out/test")]),s._v("文件夹。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("out/test/**\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"使用travis-ci自动测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用travis-ci自动测试"}},[s._v("#")]),s._v(" 使用Travis CI自动测试")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("你也可以用诸如"),e("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Travis CI"),e("OutboundLink")],1),s._v("自动构建机器来自动运行测试。")]),s._v(" "),e("p",[s._v("为了启动自动插件测试，"),e("code",[s._v("vscode")]),s._v("包需要提供一个可以运行下列任务的测试命令：")]),s._v(" "),e("ul",[e("li",[s._v("下载和解压VS Code")]),s._v(" "),e("li",[s._v("在VS Code内加载插件测试任务")]),s._v(" "),e("li",[s._v("将测试结果输出到控制台中，或在异常中退出")])]),s._v(" "),e("p",[s._v("为了完成这项命令，打开你的"),e("code",[s._v("package.json")]),s._v("然后将下列代码添加到"),e("code",[s._v("scripts")]),s._v("中：")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"test"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node ./node_modules/vscode/bin/test"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("你可以在顶层配置一个"),e("code",[s._v(".travis.yml")]),s._v("文件，就可以轻松地启用Travis CI了：")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sudo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("os")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" osx\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" linux\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" if "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(' $TRAVIS_OS_NAME == "linux" '),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('; then\n      export CXX="g++'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('4.9" CC="gcc'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('4.9" DISPLAY='),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("99.0;\n      sh "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("e /etc/init.d/xvfb start;\n      sleep 3;\n    fi\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm install\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run vscode"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("prepublish\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm test "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("silent\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("p",[s._v("上述脚本可以运行在Linux和macOS上，值得注意的一点是为了在Linux上运行测试，你需要配置一个"),e("code",[s._v("before_install")]),s._v("告诉Linux在构建中启动VS Code。")]),s._v(" "),e("p",[s._v("下面是一些用于测试运行器的可选的环境变量：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("名称")]),s._v(" "),e("th",[s._v("描述")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("CODE_VERSION")]),s._v(" "),e("td",[s._v("运行测试的VS Code版本（如：0.10.10）")])]),s._v(" "),e("tr",[e("td",[s._v("CODE_DOWNLOAD_URL")]),s._v(" "),e("td",[s._v("下载VS Code的完整URL")])]),s._v(" "),e("tr",[e("td",[s._v("CODE_TESTS_PATH")]),s._v(" "),e("td",[s._v("执行测试的位置（默认是process.cwd()/out/test or process.cwd()/test）")])]),s._v(" "),e("tr",[e("td",[s._v("CODE_EXTENSIONS_PATH")]),s._v(" "),e("td",[s._v("加载插件的位置（默认是process.cwd()）")])]),s._v(" "),e("tr",[e("td",[s._v("CODE_TESTS_WORKSPACE")]),s._v(" "),e("td",[s._v("test实例打开的工作区位置（默认是CODE_TESTS_PATH）")])])])]),s._v(" "),e("h2",{attrs:{id:"在windows中使用appveyor测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在windows中使用appveyor测试"}},[s._v("#")]),s._v(" 在Windows中使用AppVeyor测试")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("你也可以在Windows中用"),e("a",{attrs:{href:"https://www.appveyor.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("AppVeyor"),e("OutboundLink")],1),s._v("进行测试")]),s._v(" "),e("h2",{attrs:{id:"下一步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下一步"}},[s._v("#")]),s._v(" 下一步")]),s._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/extension-authoring/developing-extensions.html"}},[s._v("发开插件")]),s._v(" - 学习更多调试插件的内容。")],1),s._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/Microsoft/vscode-docs/blob/master/docs/extensions/publish-extension.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("vsce"),e("OutboundLink")],1),s._v(" - 使用VSCE命令行工具发布插件。")]),s._v(" "),e("li",[e("RouterLink",{attrs:{to:"/extensibility-reference/extension-manifest.html"}},[s._v("插件配置清单")]),s._v(" - VS Code插件配置清单参阅。")],1),s._v(" "),e("li",[e("RouterLink",{attrs:{to:"/extensibility-reference/vscode-api.html"}},[s._v("扩展API")]),s._v(" - 学习更多VS Code扩展性API。")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);